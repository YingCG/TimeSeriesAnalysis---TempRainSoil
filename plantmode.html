<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Data Visualization</title>
    <style>
        body {
            display: flex;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .leftpanel {
            background-color: black;
            color: #91DDCF;
            height: 100vh;
            width: 60%;
            padding: 20px;
            overflow-y: auto;
        }
        .rightpanel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            width: 40%;
            padding: 20px;
            background-color: black;
            color: aquamarine;
        }
        .plant {
            width: 150px;
            height: 150px;
            margin: 10px;
            border: 1px solid #91DDCF;
            padding: 10px;
            text-align: center;
            cursor: pointer;
        }
        .plant img {
            width: 80px;
            height: 80px;
            margin: auto;
            display: block;
        }
        .plant p {
            margin: 0;
        }
        .chart-container {
            width: 100%;
            height: 300px;
            background-color: #fff;
            border: 1px solid #91DDCF;
            margin-bottom: 20px;
        }
        footer {
            text-align: center;
            color: dimgray;
            width: 100%;
            position: absolute;
            bottom: 0;
            padding: 10px;
            background-color: #333;
        }
    </style>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="leftpanel"  style="width: 60%">
        <h2>Today's Prediction</h2>
        <div id="prediction-values"></div>
        <div class="chart-container" id="chart"></div>
        
        <div id="plant-status"></div>
        
    </div>
    <div class="rightpanel" style="width: 40%; background-color: black; ">
    </div>
    <footer>Presentation by Ying Chiu Goh</footer>

    <script>
        Plotly.d3.csv('./predicted_data.csv', function(err, data) {
            if (err) {
                console.error("Error loading CSV file:", err);
                return;
            }

            // Group data by plant's scientific name
            var plants = {};
            data.forEach(function(row) {
                if (!plants[row['Scientific Name']]) {
                    plants[row['Scientific Name']] = {
                        dates: [],
                        predictedRain: [],
                        predictedSoilMoist: [],
                        predictedSoilTemp: [],
                        SMD: [],
                        droughtCondition: [],
                        growthForm: row['Growth Form and Habit'],
                        threatStatus: row['Threat Status'],
                        climateImpact: row['Climate Change Impact'],
                        ecosystemType: row['Ecosystem type'],
                        iucnThreatRank: row['IUCN THREAT RANK'],
                        climateChangeRisk: row['risk of negative climate change effects'],
                        habitatDistribution: row['Habitat type and distribution in New Zealand'],
                        plantImage: row['Plant Image URL']
                    };
                }
                plants[row['Scientific Name']].dates.push(row.Date);
                plants[row['Scientific Name']].predictedRain.push(+row['Predicted Rain(mm)']);
                plants[row['Scientific Name']].predictedSoilMoist.push(+row['Predicted SoilMoist']);
                plants[row['Scientific Name']].predictedSoilTemp.push(+row['Predicted SoilTemp']);
                plants[row['Scientific Name']].SMD.push(+row['SMD']);
                plants[row['Scientific Name']].droughtCondition.push(row['Drought Condition']);
            });

            // Prepare traces for the weekly chart
            var weeklyData = [];
            Object.keys(plants).forEach(function(plant, index) {
                weeklyData.push({
                    x: plants[plant].dates,
                    y: plants[plant].predictedRain,
                    mode: 'lines+markers',
                    name: plant
                });
            });

            var weeklyLayout = {
                title: 'Weekly Predicted Rainfall',
                xaxis: {
                    title: 'Date'
                },
                yaxis: {
                    title: 'Rainfall (mm)'
                }
            };

            Plotly.newPlot('chart', weeklyData, weeklyLayout);

            // Create plant information squares
            Object.keys(plants).slice(0, 12).forEach(function(plant, index) {
                var plantData = plants[plant];
                var plantSquare = document.createElement('div');
                plantSquare.className = 'plant';
                plantSquare.innerHTML = `
                    <h3>${plant}</h3>
                    <img src="${plantData.plantImage}" alt="${plant}" />
                    <p id="details-${index + 1}">Details</p>
                `;
                plantSquare.addEventListener('click', function() {
                    updatePlantInfo(plantData, 0); // Update plant info for the first data point initially
                });
                document.getElementById('plant-status').appendChild(plantSquare);
            });

            // Update plant information based on click
            function updatePlantInfo(plantData, index) {
                var plantInfoHTML = `
                    <h2>${plantData.growthForm}</h2>
                    <p><strong>Scientific Name:</strong> ${Object.keys(plants)[0]}<br>
                    <strong>Date:</strong> ${plantData.dates[index]}<br>
                    <strong>Predicted Rain:</strong> ${plantData.predictedRain[index]} mm<br>
                    <strong>Predicted Soil Moisture:</strong> ${plantData.predictedSoilMoist[index]}<br>
                    <strong>Predicted Soil Temperature:</strong> ${plantData.predictedSoilTemp[index]} Â°C<br>
                    <strong>SMD:</strong> ${plantData.SMD[index]}<br>
                    <strong>Drought Condition:</strong> ${plantData.droughtCondition[index]}<br>
                    <strong>Threat Status:</strong> ${plantData.threatStatus}<br>
                    <strong>Climate Change Impact:</strong> ${plantData.climateImpact}<br>
                    <strong>Ecosystem Type:</strong> ${plantData.ecosystemType}<br>
                    <strong>IUCN Threat Rank:</strong> ${plantData.iucnThreatRank}<br>
                    <strong>Climate Change Risk:</strong> ${plantData.climateChangeRisk}<br>
                    <strong>Habitat Distribution:</strong> ${plantData.habitatDistribution}</p>
                `;
                document.getElementById('prediction-values').innerHTML = plantInfoHTML;

                // Update plant status based on soil moisture
                var plantStatusHTML = '';
                var smd = plantData.SMD[index];
                if (smd >= 50) {
                    plantStatusHTML = `<p>${plantData.growthForm} is happy today!</p>`;
                } else {
                    plantStatusHTML = `<p>${plantData.growthForm} is not happy today.</p>`;
                }
                document.getElementById(`details-${0 + 1}`).innerHTML = plantStatusHTML;
            }
        });
    </script>
</body>
</html>
